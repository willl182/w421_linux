- # 2026-02-24

- ## Resumen diario
- Se resolvio el bloqueo principal de OpenClaw Web UI: no era red ni puerto, era flujo de pairing/auth.
- Validado estado base del servicio: contenedor `Up`, `HTTP/1.1 200` en `127.0.0.1:57086` y `tailscale serve` correcto.
- Se identifico el error recurrente en logs: `code=1008 reason=pairing required`.
- Se aprobo pairing de Telegram correctamente con `openclaw pairing approve --channel telegram <CODIGO>` dentro del contenedor.

- ## Avance de configuracion
- Runbook de Telegram documentado en `[[OpenClaw Telegram Pairing (VPS + Docker)]]`.
- Se agrego procedimiento de fallback para forzar `dmPolicy=allowlist` y `allowFrom`.
- Se confirmo validacion de Telegram API con `getMe` en `"ok":true` para bot `@w421claw_bot`.
- Aprendizaje clave: `docker compose restart` puede no reflejar cambios esperados de `.env`; usar `up -d --force-recreate` cuando hay dudas.
- Pendiente de hardening: cerrar con auth estricta (`allowInsecureAuth=false`) y rotar cualquier secreto publicado en chat/shell history.

- ## Comandos que destrabaron
- `docker exec -it openclaw-hacw-openclaw-1 openclaw pairing list --channel telegram`
- `docker exec -it openclaw-hacw-openclaw-1 openclaw pairing approve --channel telegram <CODIGO>`
- `sudo docker compose -f /docker/openclaw-hacw/docker-compose.yml restart`
- `sudo docker compose --env-file /docker/openclaw-hacw/.env -f /docker/openclaw-hacw/docker-compose.yml up -d --force-recreate`
- `docker exec -it openclaw-hacw-openclaw-1 sh -lc 'curl -s "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/getMe"'`

- ## Hardening VPS aplicado
- Se corrigio SSH para desactivar autenticacion por password en runtime.
- Resultado final validado:
- `port 22`
- `permitrootlogin no`
- `pubkeyauthentication yes`
- `passwordauthentication no`
- `kbdinteractiveauthentication no`
- Causa raiz: `/etc/ssh/sshd_config.d/50-cloud-init.conf` forzaba `PasswordAuthentication yes`.
- Accion: archivo conflictivo deshabilitado y persistencia en cloud-init con `ssh_pwauth: false`.
- UFW ajustado para eliminar `OpenSSH Anywhere` y dejar acceso SSH por IP especifica.
- Pendiente operativo: activar `fail2ban`.
