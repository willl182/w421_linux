- # 2026-02-24

- ## Resumen diario
- Se resolvio el bloqueo principal de OpenClaw Web UI: no era red ni puerto, era flujo de pairing/auth.
- Validado estado base del servicio: contenedor `Up`, `HTTP/1.1 200` en `127.0.0.1:57086` y `tailscale serve` correcto.
- Se identifico el error recurrente en logs: `code=1008 reason=pairing required`.
- Se aprobo pairing de Telegram correctamente con `openclaw pairing approve --channel telegram <CODIGO>` dentro del contenedor.

- ## Avance de configuracion
- Runbook de Telegram documentado en `[[OpenClaw Telegram Pairing (VPS + Docker)]]`.
- Se agrego procedimiento de fallback para forzar `dmPolicy=allowlist` y `allowFrom`.
- Se confirmo validacion de Telegram API con `getMe` en `"ok":true` para bot `@w421claw_bot`.
- Aprendizaje clave: `docker compose restart` puede no reflejar cambios esperados de `.env`; usar `up -d --force-recreate` cuando hay dudas.
- Pendiente de hardening: cerrar con auth estricta (`allowInsecureAuth=false`) y rotar cualquier secreto publicado en chat/shell history.

- ## Comandos que destrabaron
- `docker exec -it openclaw-hacw-openclaw-1 openclaw pairing list --channel telegram`
- `docker exec -it openclaw-hacw-openclaw-1 openclaw pairing approve --channel telegram <CODIGO>`
- `sudo docker compose -f /docker/openclaw-hacw/docker-compose.yml restart`
- `sudo docker compose --env-file /docker/openclaw-hacw/.env -f /docker/openclaw-hacw/docker-compose.yml up -d --force-recreate`
- `docker exec -it openclaw-hacw-openclaw-1 sh -lc 'curl -s "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/getMe"'`

- ## Hardening VPS aplicado
- Se corrigio SSH para desactivar autenticacion por password en runtime.
- Resultado final validado:
- `port 22`
- `permitrootlogin no`
- `pubkeyauthentication yes`
- `passwordauthentication no`
- `kbdinteractiveauthentication no`
- Causa raiz: `/etc/ssh/sshd_config.d/50-cloud-init.conf` forzaba `PasswordAuthentication yes`.
- Accion: archivo conflictivo deshabilitado y persistencia en cloud-init con `ssh_pwauth: false`.
- UFW ajustado para eliminar `OpenSSH Anywhere` y dejar acceso SSH por IP especifica.

- ## Fail2ban ajustado
- Instalado y habilitado con arranque automatico.
- Verificacion final:
- `systemctl is-active fail2ban` -> `active`
- `fail2ban-client ping` -> `Server replied: pong`
- `fail2ban-client status` -> jail `sshd`
- `fail2ban-client status sshd` -> filtro activo, sin bans al cierre.
- Ajuste aplicado en jail SSH: `backend=systemd`, `maxretry=5`, `findtime=10m`, `bantime=1h`.
- `ignoreip` definido para `127.0.0.1/8`, `::1`, `100.64.0.0/10` y la IP operativa actual.

- ## Gmail realtime con OpenClaw + Gog + Funnel
- Se corrigio acceso SSH operativo moviendo alias `vps-openclaw` a tailnet (`srv1408623`) por timeout en IP publica.
- Se creo e instalo credencial OAuth Desktop app para `gog` y se completo login de `rafiki182.claw@gmail.com` por flujo remoto (`--remote --step=1/2`).
- Se detecto bloqueo de app en Testing (`403 access_denied`) y se resolvio agregando test users en OAuth consent.
- Se configuro `gog` keyring backend `file` y variable `GOG_KEYRING_PASSWORD`; se corrigio error de integridad de keyring reseteando tokens y relogin.
- Se instalo `google-cloud-cli` dentro del contenedor por error `gcloud not installed`.
- Se ejecuto `openclaw webhooks gmail setup` con `--tailscale off` y `--push-endpoint` explicito por error `tailscale not installed` en contenedor.
- Se habilito Funnel en host para path dedicado `/gmail-pubsub` sin exponer mas superficie de la necesaria.
- Resultado: watch/listener Gmail activo en `0.0.0.0:8788/gmail-pubsub` con endpoint publico `https://srv1408623.tail7009c7.ts.net/gmail-pubsub`.

- ## Fix post-reboot automatizado (VPS)
- Se persistio `GOG_KEYRING_PASSWORD` y `OPENCLAW_HOOKS_TOKEN` en `/docker/openclaw-hacw/.env`.
- Se instalo script de correccion post-boot en `/usr/local/bin/openclaw-postboot-fix.sh`.
- Se instalo y habilito servicio `systemd` `openclaw-postboot-fix.service` para aplicar fix tras reinicio.
- El servicio parchea bootstrap de Hostinger para evitar que `hooks.token` vuelva a igualarse a `gateway.auth.token`.
- Verificacion final: contenedor estable (`Up`), gateway escuchando en `ws://127.0.0.1:18789`, watcher Gmail levantado y push sintetico con HTTP `200`.
