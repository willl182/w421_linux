# Problem Record (Troubleshooting)

**Severity**: Medium

## The Problem

Durante la implementacion de Gmail realtime aparecieron bloqueos encadenados:

- SSH por alias a IP publica con timeout (`22/tcp`) por hardening/UFW.
- OAuth incompleto por falta de `credentials.json` y app en modo Testing sin test user autorizado.
- Flujo localhost invalido en VPS headless.
- Keyring no interactivo (`no TTY`) y mismatch de clave (`aes.KeyUnwrap() integrity check failed`).
- Setup Gmail bloqueado por dependencias ausentes (`gcloud not installed`) y por asumir tailscale en contenedor (`tailscale not installed`).
- Con `--tailscale off`, setup exigio `--push-endpoint` explicito.

## The Solution / Workaround

1. Mover SSH operativo a tailnet (`HostName srv1408623`).
2. Registrar OAuth client y agregar cuenta como Test User.
3. Usar `gog login --remote --step=1/2` para autenticar headless.
4. Configurar keyring `file`, definir `GOG_KEYRING_PASSWORD` fijo y resetear keyring corrupto.
5. Instalar y autenticar `gcloud` dentro del contenedor.
6. Ejecutar setup con `--tailscale off --push-endpoint <funnel-url>`.
7. Exponer `/gmail-pubsub` por Funnel desde host y levantar runner persistente.

## Learnings to Preserve

- Para push realtime, Serve tailnet-only no alcanza; se necesita endpoint publico HTTPS.
- En servidores sin GUI, OAuth debe dise√±arse desde el inicio como flujo manual remoto.
- Keyring file en automatizacion requiere variable de entorno estable o falla al leer tokens.
- `openclaw webhooks gmail setup` mezcla dependencias de nube y red; validar prerequisitos antes de ejecutar.
- `502` en Funnel suele ser backend caido; `404/405` puede ser normal en endpoint webhook segun metodo.
